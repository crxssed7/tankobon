{% extends "base.html" %}

{% load static %}
{% load bleach_tags %}
{% load utility %}

{% block title %}
    Manga - Tankōbon
{% endblock title %}

{% block extrahead %}
    <!-- Link Swiper's CSS -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"/>
    <link rel="stylesheet"
          type="text/css"
          href="{% static 'css/shared/_poster_chip.css' %}"/>
    <link rel="stylesheet"
          type="text/css"
          href="{% static 'css/shared/_search_result.css' %}"/>
    <link rel="stylesheet"
          type="text/css"
          href="{% static 'css/web/swiper.css' %}"/>
{% endblock extrahead %}

{% block content %}
    <div class="slider">
        <!-- Swiper -->
        <div class="swiper mySwiper">
            <div class="swiper-wrapper">
                {% for manga in recently_updated %}
                    <div class="swiper-slide"
                         style="background-image: url('{{ manga.banner }}')">
                        <div class="gradient-bg">
                            <div class="container">
                                <div class="swiper-details">
                                    <h1 class="swiper-name"><b>{{ manga.name }}</b></h1>
                                    <div class="display-flex wrap">
                                        <p>
                                            <span class="badge bg-dark">{{ manga.volume_count }} volumes</span>
                                        </p>
                                        <p>
                                            <span class="badge bg-dark">{{ manga.status }}</span>
                                        </p>
                                    </div>
                                    <div class="swiper-manga-description-wrapper mobile-hidden">
                                        <p>
                                            <small>{{ manga.description | bleach:"br,b" }}</small>
                                        </p>
                                    </div>
                                    <a class="btn btn-tankobon" href="{% url 'manga' manga.id %}">View</a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="swiper-pagination"></div>
        </div>
        <!-- Swiper JS -->
        <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
        <!-- Initialize Swiper -->
        <script>
        var swiper = new Swiper(".mySwiper", {
            loop: true,
            autoplay: {
                delay: 5000,
                disableOnInteraction: false,
            },
            pagination: {
                el: ".swiper-pagination",
                dynamicBullets: true,
            },
        });
        </script>
    </div>
    <div class="container section">
        <div class="desktop-hidden">
            <form class="d-flex" action="{% url 'search' %}" method="get">
                <input name="q"
                       class="form-control me-2"
                       id="search-box"
                       type="search"
                       placeholder="Search"
                       aria-label="Search"
                       value="{{ query }}"/>
                <button class="btn btn-tankobon" type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
            </form>
            <br />
        </div>
        {% if object_list %}
        <center>
            <h3 class="header">Search results:</h3>
        </center>
        <div class="flex">
            {% for manga in object_list %}
                {% include "web/shared/_search_result.html" with manga=manga only %}
            {% endfor %}
        </div>
        {% endif %}
    </div>
    <!-- CTA's -->
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <div class="cta cta-left">
                    <h5><b>Can't find your favourite manga?</b></h5>
                    <p>
                        Tankōbon is a community driven site. If you can't find the manga you're looking for, you can <a href="{% url 'signup' %}" class="link">create an account</a> and add it yourself!
                    </p>
                    <div>
                        <a class="btn btn-tankobon" href="{% url 'new_manga' %}">Add manga!</a>
                        <a class="btn btn-tankobon" href="{% url 'all_manga' %}">View all</a>
                    </div>
                    <p class="no-mg mg-tp-16">
                        <small>Please make sure to read the <a href="{% url 'contrib' %}" class="link">Contribution Guidelines</a> before doing so.</small>
                    </p>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="cta cta-right">
                    <h5><b>We need your help!</b></h5>
                    <p>
                        If you want to contribute but you don't know where to get started, head over to the help page to see which manga has missing data.
                    </p>
                    <div>
                        <a class="btn btn-tankobon" href="{% url 'help_needed' %}">Help!</a>
                    </div>
                    <p class="no-mg mg-tp-16">
                        <small>Please make sure to read the <a href="{% url 'contrib' %}" class="link">Contribution Guidelines</a> before doing so.</small>
                    </p>
                </div>
            </div>
        </div>
    </div>
    <!-- CHIP STUFF -->
    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <center>
                    <h3 id="releasing"
                        class="mg-bt-20 mg-tp-20"><b>Releasing Manga</b></h3>
                </center>
                {% for manga in releasing %}
                    {% include "web/shared/_poster_chip.html" with manga=manga only %}
                {% endfor %}
                <center>
                    <a class="btn btn-tankobon mg-10"
                       href="{% url 'all_manga' %}{% urlparams status='releasing' %}">View all releasing
                    series</a>
                </center>
            </div>
            <div class="col-sm-6">
                <center>
                    <h3 id="completed"
                        class="mg-bt-20 mg-tp-20"><b>Completed Manga</b></h3>
                </center>
                {% for manga in completed %}
                    {% include "web/shared/_poster_chip.html" with manga=manga only %}
                {% endfor %}
                <center>
                    <a class="btn btn-tankobon mg-10"
                       href="{% url 'all_manga' %}{% urlparams status='finished' %}">View all completed
                    series</a>
                </center>
            </div>
        </div>
    </div>
{% endblock content %}
